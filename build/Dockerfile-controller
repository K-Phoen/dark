# Build
FROM golang:1.17-alpine3.14 AS build

RUN apk --update --no-cache add make=4.3-r0

WORKDIR /app
COPY . /app

RUN make controller_build

# Run

FROM alpine:3.14
ENTRYPOINT ["/app/dark-controller"]
WORKDIR /app
RUN apk --update --no-cache add ca-certificates=20191127-r5 && update-ca-certificates

COPY --from=build /app/dark-controller /app/dark-controller
